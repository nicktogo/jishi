{% extends "navbar.html" %}
{% block page_specified %}
    <script src="http://s.codepen.io/assets/libs/modernizr.js" type="text/javascript"></script>
{% endblock %}
{% block page_specified_css %}
    <link rel="stylesheet" href="http://codepen.io/assets/reset/normalize.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/material-searchbar.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/material-button.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/message.css') }}">
    <script>
        window.console = window.console || function (t) {
                };
    </script>
{% endblock %}
{% block body %}

    <div id="demo" class="wrapper">
        <div class="sw">
            <form id="search_mes" method="post" action="{{ url_for('message_search') }}">
                <input name="input" type="text" class="search" placeholder="项目名称/所有人"/>
                <button class="go" type="submit"><span class="entypo-search"></span></button>
                <a href="#" class="logo" title="logo"></a>
            </form>
        </div>
        <div class="table-responsive-vertical shadow-z-1">
            <!-- Table starts here -->
            <table id="table" class="table table-hover table-mc-light-blue">
                <thead>
                <tr>
                    <th>项目名称</th>
                    <th>所有人</th>
                    <th>消息类型</th>
                    <th>创建时间</th>
                    <th>Button</th>
                </tr>
                </thead>
                <tbody>
                {%for message in msgs %}
                <tr data-toggle="modal" data-target="#myModal" data-message = "{{message['message_type']}}" >
                    <td data-title="ProjectName">{{message['projectname']}}</td>
                    <td data-title="Owner">{{message['project_owner']}}</td>
                    <td data-title="Status" class="mes_type">
                        {{message['message_type']}}
                    </td>
                    <td data-title="CreateTime">{{message['created_time']}}</td>
                    <!--<td>{{message['project_owner']}}-->
                    <!--<td class="mes_type">{{message['message_type']}}-->
                    <!--<td >{{message['created_time']}}-->
                    <!--<td class="mes_btn" onclick="permit(this)"> <button>同意</button>-->
                    <td data-title="Button">
                        <button type="button" class="btn btn-raised ripple-effect btn-default" onclick="permit(this)">Approve</button>
                    </td>
                    <input id="message_id" type="hidden" value="{{message['_id']}}">

                 </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <script type="text/javascript">
        $(function () {
            var types = ["申请", "同意", "退出", "被踢出"];
            $('.mes_type').each(function (elem) {
                console.log($(this).text());
                $(this).text(types[parseInt($(this).text())]);
            });
        });


        function permit(btn) {
        var message_id = $("#message_id").val();
        alert(message_id)
        var data = {'message_id': message_id}
        $.ajax({
            url: "/project/permit",
            data: JSON.stringify(data),
            contentType: 'application/json',
            type: 'POST',
            dataType: 'json',
            success: function (data) {
                alert(data['message_id'] + "同意申请!")
                },
            error: function (data) {
                console.log(data)
                }
            })

        }
        function search(btn){
        var input = $("#search_message").val()
        alert(input)
        var data = {'input':input}
         $.ajax({
                url: "/message/search",
                data: JSON.stringify(data),
                contentType: 'application/json',
                type: 'POST',
                dataType: 'json',
                success: function (data) {
                    alert(data['input'] + "创建成功!")
                },
                error: function (data) {
                    console.log(data)
                }
            })

    }



    </script>
    {#    <script src="{{ url_for('static', filename='js/material-sidebar.js') }}"></script>#}
{% endblock %}
<script>

</script>

